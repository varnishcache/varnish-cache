varnishtest "Test drain_timeout=0 does immediate shutdown"

# Test that with drain_timeout=0, SIGTERM causes immediate shutdown
# without entering drain mode

server s1 {
	rxreq
	txresp -body "response"
} -start

varnish v1 -arg "-p drain_timeout=0" -vcl+backend { } -start

# Verify varnish is running
client c1 {
	txreq -url "/"
	rxresp
	expect resp.status == 200
} -run

server s1 -wait

# Send SIGTERM - should cause immediate shutdown (drain_timeout=0)
shell "kill -15 ${v1_pid}"

# Use -cleanup since varnish will exit on its own
varnish v1 -cleanup
